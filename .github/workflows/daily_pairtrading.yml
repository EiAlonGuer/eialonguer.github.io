name: Daily Pairs Trading Update

on:
  schedule:
    # Runs at 21:00 UTC every day (approx Market Close)
    - cron: '0 21 * * *'
  workflow_dispatch: # Allows you to click "Run workflow" manually in GitHub Actions tab

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write # CRITICAL: Allows the bot to write the JSON file back to the repo

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas numpy pykalman

    - name: Run Strategy Script
      env:
        # Make sure you added this in Settings > Secrets and variables > Actions
        TIINGO_API_KEY: ${{ secrets.TIINGO_KEY }}
      run: python PairTrading/main.py
      
    - name: Commit and Push Data
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add Pairtrading/dashboard_data.json
        git commit -m "Auto-update: Pairtrading data" || exit 0
        git push
